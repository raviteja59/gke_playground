gcloud compute instances create nat-gateway --network default   --can-ip-forward --zone us-central1-a --image-family=centos-7   --image-project=centos-cloud  --boot-disk-size 10G   --machine-type f1-micro

gcloud compute routes create nat-internet-route --network default   --destination-range 0.0.0.0/0   --next-hop-instance nat-gateway   --next-hop-instance-zone us-central1-a   --tags no-ip --priority 900

for k in $(kubectl get nodes| awk -F " " '{print $1}'| grep gke); do gcloud compute instances add-tags $k  --tags no-ip --zone us-central1-a; done


kubectl create sa tiller -n kube-system && kubectl create clusterrolebinding tiller-cluster-rule --clusterrole=cluster-admin --serviceaccount=kube-system:tiller


helm init

kubectl patch deploy --namespace kube-system tiller-deploy -p '{"spec":{"template":{"spec":{"serviceAccount":"tiller"}}}}'

 helm repo add incubator http://storage.googleapis.com/kubernetes-charts-incubator

helm install --name my-kafka incubator/kafka

helm repo add landoop https://landoop.github.io/kafka-helm-charts/


helm install landoop/lenses  --name  lenses --set ingress.enabled=false

kubectl expose svc lenses --type=LoadBalancer --name=lenses-expose




Once you have the testclient pod above running, you can list all kafka
topics with:

  kubectl -n default exec testclient -- /usr/bin/kafka-topics --zookeeper my-kafka-zookeeper:2181 --list

To create a new topic:

  kubectl -n default exec testclient -- /usr/bin/kafka-topics --zookeeper my-kafka-zookeeper:2181 --topic test1 --create --partitions 1 --replication-factor 1

To listen for messages on a topic:

  kubectl -n default exec -ti testclient -- /usr/bin/kafka-console-consumer --bootstrap-server my-kafka:9092 --topic test1 --from-beginning

To stop the listener session above press: Ctrl+C

To start an interactive message producer session:
  kubectl -n default exec -ti testclient -- /usr/bin/kafka-console-producer --broker-list my-kafka-headless:9092 --topic test1

To create a message in the above session, simply type the message and press "enter"
To end the producer session try: Ctrl+C